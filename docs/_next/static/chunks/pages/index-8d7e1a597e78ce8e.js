(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(3619)}])},3619:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return O}});var i=n(5893),a=n(9008),o=n.n(a),c=n(4523),r=n.n(c),s=n(7294),l=n(1664),u=n.n(l),d=n(7614),f=n(3636);n(8804);var g=n(3111),p=n(6667);function h(e){let[t,n]=(0,s.useState)({loggedInAccount:void 0,loggedInPublicKey:void 0}),[a,o]=(0,s.useState)("");return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"flex-col",hidden:!!t.loggedInAccount,children:[(0,i.jsx)("div",{children:(0,i.jsx)("input",{type:"text",onChange:e=>o(e.target.value)})}),(0,i.jsxs)("div",{className:"flex flex-row text-xs items-center",children:[(0,i.jsx)("a",{href:"",onClick:async t=>{t.preventDefault();let{accountNameRes:i,pubKeyRes:o}=await x(a);n({loggedInAccount:i,loggedInPublicKey:o}),e.setUser(i)},children:"Register"}),(0,i.jsx)("span",{children:"/"}),(0,i.jsx)("a",{href:"",onClick:async t=>{t.preventDefault();let{accountNameRes:i,pubKeyRes:o}=await y(a);n({loggedInAccount:i,loggedInPublicKey:o}),e.setUser(i),await (0,d.tx)('(posts.create-account {accountName} (read-keyset "sessionKeyset" "tmp.jpg"))',!1)},children:"Sign In"})]})]}),(0,i.jsxs)("div",{className:"flex-col",hidden:!t.loggedInAccount,children:[(0,i.jsx)("p",{children:t.loggedInAccount}),(0,i.jsx)("p",{className:"text-ellipsis",children:t.loggedInPublicKey}),(0,i.jsx)("a",{href:"",onClick:async e=>{await m(e),n({loggedInAccount:void 0,loggedInPublicKey:void 0})},children:"Logout"})]})]})}async function m(e){let t=await fetch(p.b+"/api/v1/auth/logout",{credentials:"include"});if(!t.ok)throw Error(await t.text())}async function x(e){let t=await fetch(p.b+"/api/v1/auth/register/begin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accountName:e,accountDisplayName:e}),credentials:"include"}).catch(e=>e);if(!t.ok)throw Error(await t.text());let n=await t.json(),i=await (0,g.Ue)({publicKey:n}),a=await fetch(p.b+"/api/v1/auth/register/complete",{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!a.ok)throw Error(await t.text());let o=await a.json();console.log(JSON.stringify(o)),document.cookie="credentialId="+i.id,console.log("Set cookie");let c=await v();return{accountNameRes:c.accountName,pubKeyRes:c.pubKey}}async function y(e){console.log("login");let t=await fetch(p.b+"/api/v1/auth/login/begin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"});if(!t.ok)throw Error(await t.text());let n=await t.json();console.log("login response:"),console.log(n);let i=await (0,g.U2)({publicKey:n}),a=await fetch(p.b+"/api/v1/auth/login/complete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i),credentials:"include"});if(!a.ok)throw Error(await a.text());let o=await a.json();console.log(JSON.stringify(o)),document.cookie="credentialId="+i.id,console.log("Login Set cookie");let c=await v();return{accountNameRes:c.accountName,pubKeyRes:c.pubKey}}async function v(){console.log("setup_account_cookies");let e=await fetch(p.b+"/api/v1/auth/account-info",{credentials:"include"});if(!e.ok)throw Error(await e.text());let t=await e.json(),n=t.publicKeyHex;return console.log("setting public-key cookie to "+n),document.cookie="public-key="+n,console.log("setting account-name cookie to "+t.accountName),document.cookie="account-name="+t.accountName,console.log("finished setup_account_cookies"),{accountName:t.accountName,pubKey:n}}function b(e){return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("img",{src:e.src})})}function j(e){let[t,n]=(0,s.useState)([]);return(0,s.useEffect)(()=>{(async function(){let t=await (0,d.tx)('(accounts.get-pictures "'.concat(e.accountName,'")'),!1);n(t.result.data),t.result.data})()},[]),(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{className:"flex flex-col",children:[(0,i.jsx)("div",{children:"Pictures"}),(0,i.jsx)("div",{children:t.map(e=>(0,i.jsx)(b,{id:e.id,src:e.src},e.id))})]})})}var w=n(4080),N=n(4361),_=n(8247);function k(e){let[t,n]=(0,s.useState)(!0),[a,o]=(0,s.useState)(null),[c,r]=(0,s.useState)(!1);function l(){n(!1)}async function u(t){var n=new Uint8Array(32);self.crypto.getRandomValues(n);let i=(0,_.c)(n),o=await (0,d.tx)('(accounts.create-picture "'.concat(e.accountName,'" "').concat(i,'" "').concat(a,'")'),!1);console.log(await o.json())}return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{className:"",children:[(0,i.jsx)("button",{type:"button",onClick:function(){n(!0)},className:"rounded-md bg-black bg-opacity-20 px-4 py-2 text-sm font-medium text-white hover:bg-opacity-30 focus:outline-none focus-visible:ring-2 focus-visible:ring-hite focus-visible:ring-opacity-75",children:"Add Pictures"}),(0,i.jsx)(w.u,{appear:!0,show:t,as:s.Fragment,children:(0,i.jsxs)(N.V,{as:"div",className:"relative z-10",onClose:l,children:[(0,i.jsx)(w.u.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-25"})}),(0,i.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,i.jsx)("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:(0,i.jsx)(w.u.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,i.jsxs)(N.V.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl bg-white p-6 text-left align-middle shadow-xl transition-all",children:[(0,i.jsx)(N.V.Title,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900",children:"Dialog Title"}),(0,i.jsxs)("div",{className:"mt-2",children:[(0,i.jsx)("input",{type:"file",onChange:function(e){let t=e.target.files[0];console.log(t);let n=new FileReader;n.onloadend=()=>{o(n.result),r(!0)},n.readAsDataURL(t)}}),(0,i.jsx)("p",{children:null==a?void 0:a.toString()}),(0,i.jsx)("img",{src:null==a?void 0:a.toString()}),c&&(0,i.jsx)("div",{children:(0,i.jsx)("button",{className:"inline-flex justify-center rounded-md border border-transparent bg-blue-100 px-4 py-2 text-sm font-medium text-blue-900 hover:bg-blue-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2",onClick:async e=>u(e),children:"Upload"})})]}),(0,i.jsx)("div",{className:"mt-4",children:(0,i.jsx)("button",{type:"button",className:"inline-flex justify-center rounded-md border border-transparent bg-blue-100 px-4 py-2 text-sm font-medium text-blue-900 hover:bg-blue-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2",onClick:l,children:"Close"})})]})})})})]})})]})})}var S=n(7814),C=n(4288);function I(e){return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("header",{className:"flex items-center justify-between px-4 py-2 bg-blue-100",children:[(0,i.jsx)("div",{className:"flex items-center",children:"Header"}),e.user?(0,i.jsxs)("div",{children:[(0,i.jsx)(S.G,{icon:C.w49}),(0,i.jsx)("p",{onClick:t=>{(0,e.setUser)(void 0)},children:"Logout"})]}):(0,i.jsx)("p",{children:"No user"})]})})}function O(){let[e,t]=(0,s.useState)(void 0),[n,a]=(0,s.useState)(null);return(0,s.useEffect)(()=>{t((0,d.ej)("account-name"))},[]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(o(),{children:[(0,i.jsx)("title",{children:"Kadena Photos"}),(0,i.jsx)("meta",{name:"description",content:"Generated by create next app"}),(0,i.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,i.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,i.jsx)(I,{user:e,setUser:t}),(0,i.jsxs)("main",{className:r().main,children:[e?(0,i.jsxs)("div",{className:"flex flex-row",children:[(0,i.jsxs)("p",{children:["Hello ",e]}),(0,i.jsx)(u(),{href:"/admin",children:"Admin"})]}):(0,i.jsx)("div",{className:r().description,children:(0,i.jsx)(h,{setUser:t})}),e&&(0,i.jsxs)("div",{children:[(0,i.jsx)(k,{accountName:e}),(0,i.jsx)(j,{accountName:e})]})]})]})}f.vc.autoAddCss=!1},6667:function(e,t,n){"use strict";n.d(t,{b:function(){return i}});let i="https://beanstalk.greg-testing-2023-02-07.com"},7614:function(e,t,n){"use strict";n.d(t,{ej:function(){return l},tx:function(){return s}});var i=n(7462),a=n.n(i),o=n(8247),c=n(6667),r=n(3111);async function s(e,t){let n=l("credentialId"),i={pubKey:l("public-key")};var s=new Uint8Array(32);self.crypto.getRandomValues(s);let u=JSON.stringify({networkId:null,payload:{exec:{data:{name:"Stuart",language:"Pact",sessionKeyset:[l("public-key")]},code:e}},signers:t?[i]:[],meta:{creationTime:0,ttl:0,gasLimit:0,chainId:"",gasPrice:0,sender:""},nonce:(0,o.c)(s)}),d=function(e){var t=new TextEncoder,n=new Uint8Array(32);let i=a()(n.length).update(t.encode(e)).digest(),c=(0,o.c)(i).replaceAll("/","_").replaceAll("+","-");return c}(u);var f={};if(t){let e=await (0,r.U2)({publicKey:{challenge:d,allowCredentials:[{id:n,type:"public-key"}],userVerification:"preferred"}}),t=e.response;f={authenticatorData:(0,o.c)((0,r.kI)(t.authenticatorData)),clientDataJSON:t.clientDataJSON,signature:(0,o.c)((0,r.kI)(t.signature))}}let g=t?[{sig:JSON.stringify(f)}]:[],p=await fetch(c.b+"/api/v1/execute",{method:"POST",headers:{"Content-Type":"application/json"},cache:"no-cache",body:JSON.stringify({hash:d,sigs:g,cmd:u}),credentials:"include"}),h=await p.json();return h}function l(e){var t;let n="; ".concat(document.cookie),i=n.split("; ".concat(e,"="));if(2===i.length)return null===(t=i.pop())||void 0===t?void 0:t.split(";").shift()}},3111:function(e,t,n){"use strict";function i(e){let t="==".slice(0,(4-e.length%4)%4),n=e.replace(/-/g,"+").replace(/_/g,"/")+t,i=atob(n),a=new ArrayBuffer(i.length),o=new Uint8Array(a);for(let e=0;e<i.length;e++)o[e]=i.charCodeAt(e);return a}function a(e){let t=new Uint8Array(e),n="";for(let e of t)n+=String.fromCharCode(e);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}n.d(t,{U2:function(){return v},Ue:function(){return y},kI:function(){return i}});var o="copy",c="convert";function r(e,t,n){if(t===o)return n;if(t===c)return e(n);if(t instanceof Array)return n.map(n=>r(e,t[0],n));if(t instanceof Object){let i={};for(let[a,o]of Object.entries(t)){if(o.derive){let e=o.derive(n);void 0!==e&&(n[a]=e)}if(a in n)null!=n[a]?i[a]=r(e,o.schema,n[a]):i[a]=null;else if(o.required)throw Error("Missing key: ".concat(a))}return i}}function s(e,t){return{required:!0,schema:e,derive:t}}function l(e){return{required:!0,schema:e}}function u(e){return{required:!1,schema:e}}var d={type:l(o),id:l(c),transports:u(o)},f={appid:u(o),appidExclude:u(o),credProps:u(o)},g={appid:u(o),appidExclude:u(o),credProps:u(o)},p={publicKey:l({rp:l(o),user:l({id:l(c),name:l(o),displayName:l(o)}),challenge:l(c),pubKeyCredParams:l(o),timeout:u(o),excludeCredentials:u([d]),authenticatorSelection:u(o),attestation:u(o),extensions:u(f)}),signal:u(o)},h={type:l(o),id:l(o),rawId:l(c),authenticatorAttachment:u(o),response:l({clientDataJSON:l(c),attestationObject:l(c),transports:s(o,e=>{var t;return(null==(t=e.getTransports)?void 0:t.call(e))||[]})}),clientExtensionResults:s(g,e=>e.getClientExtensionResults())},m={mediation:u(o),publicKey:l({challenge:l(c),timeout:u(o),rpId:u(o),allowCredentials:u([d]),userVerification:u(o),extensions:u(f)}),signal:u(o)},x={type:l(o),id:l(o),rawId:l(c),authenticatorAttachment:u(o),response:l({clientDataJSON:l(c),authenticatorData:l(c),signature:l(c),userHandle:l(c)}),clientExtensionResults:s(g,e=>e.getClientExtensionResults())};async function y(e){var t;return t=await navigator.credentials.create(r(i,p,e)),r(a,h,t)}async function v(e){var t;return t=await navigator.credentials.get(r(i,m,e)),r(a,x,t)}},4523:function(e){e.exports={main:"Home_main__EtNt2",description:"Home_description__Qwq1f",code:"Home_code__aGV0U",grid:"Home_grid__c_g6N",card:"Home_card__7oz7W",center:"Home_center__V0nxp",logo:"Home_logo__80mSr",thirteen:"Home_thirteen__ocdUI",rotate:"Home_rotate__99GkW",content:"Home_content___fOQz",vercelLogo:"Home_vercelLogo__lhIxO"}}},function(e){e.O(0,[123,930,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);