(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(2125)}])},2125:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return T}});var i=n(5893),a=n(9008),c=n.n(a),s=n(7294),o=n(7614),r=n(3636);n(8804);var l=n(7814),u=n(4288),d=n(9417);function f(e){var t;console.log(e);let n=(null===(t=e.likes)||void 0===t?void 0:t.find(t=>t==e.user))!=void 0,[a,c]=(0,s.useState)(n);return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{className:"p-1 relative shadow-lg",children:[(0,i.jsx)("img",{className:"h-40",src:e.src}),(0,i.jsx)("div",{className:"absolute bottom-2 right-2 text-red-500 opacity-90 hover:opacity-100",onClick:async t=>await p(e.user,e.id,c),children:(0,i.jsx)(l.G,{icon:a?d.m6i:u.m6i})})]})})}async function p(e,t,n){n(!0),await (0,o.tx)('(accounts.like-picture "'.concat(e,'" "').concat(t,'")'),!1)}function g(e){return(0,s.useEffect)(()=>{console.log("About to fetch pictures for ".concat(e.accountName,".")),async function(){let t=await (0,o.tx)('(accounts.get-pictures "'.concat(e.accountName,'")'),!1);e.setPictures(t.result.data),t.result.data}()},[e.accountName]),console.log("PICTURES"),console.log(e.pictures),(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{className:"flex flex-wrap",children:e.pictures.map(t=>(0,i.jsx)(f,{id:t["picture-id"],src:t.src,likes:t.likes,user:e.user},t["picture-id"]))})})}var h=n(4080),m=n(4361),x=n(8247);function y(e){let[t,n]=(0,s.useState)(!1),[a,c]=(0,s.useState)(null),[r,l]=(0,s.useState)(!1),[u,d]=(0,s.useState)(!1),[f,p]=(0,s.useState)(!1);function g(){n(!1)}async function y(t){d(!0),p(!1);var n=new Uint8Array(32);self.crypto.getRandomValues(n);let i=(0,x.c)(n);await (0,o.tx)('(accounts.create-picture "'.concat(e.accountName,'" "').concat(i,'" "').concat(a,'")'),!1).then(t=>{e.setPictures([{id:i,"picture-id":i,src:a},...e.pictures]),d(!1),p(!0)})}return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{className:"",children:[(0,i.jsx)("button",{type:"button",onClick:function(){n(!0)},className:"rounded-md bg-black bg-opacity-20 px-4 py-2 text-sm font-medium text-white hover:bg-opacity-30 focus:outline-none focus-visible:ring-2 focus-visible:ring-hite focus-visible:ring-opacity-75",children:"Add Pictures"}),(0,i.jsx)(h.u,{appear:!0,show:t,as:s.Fragment,children:(0,i.jsxs)(m.V,{as:"div",className:"relative z-10",onClose:g,children:[(0,i.jsx)(h.u.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-25"})}),(0,i.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,i.jsx)("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:(0,i.jsx)(h.u.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,i.jsxs)(m.V.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl bg-white p-6 text-left align-middle shadow-xl transition-all dark:bg-slate-600",children:[(0,i.jsx)(m.V.Title,{as:"h3",className:"text-lg font-medium leading-6",children:"Upload a Picture"}),(0,i.jsxs)("div",{className:"mt-2",children:[(0,i.jsx)("input",{type:"file",onChange:function(e){let t=e.target.files[0],n=new FileReader;n.onloadend=()=>{var e=document.createElement("img");e.onload=function(n){let i=320/e.width,a=240/e.height,s=i<1||a<1?Math.min(i,a):1;var o=document.createElement("canvas");o.height=e.height*s,o.width=e.width*s;var r=o.getContext("2d");null==r||r.drawImage(e,0,0,e.width*s,e.height*s),c(o.toDataURL(t.type))},n.result&&(e.src=n.result.toString()),l(!0)},n.readAsDataURL(t)}}),(0,i.jsx)("p",{children:null==a?void 0:a.toString()}),(0,i.jsx)("img",{src:null==a?void 0:a.toString()}),r&&(0,i.jsx)("div",{children:(0,i.jsx)("button",{className:"inline-flex justify-center rounded-md border border-transparent bg-blue-100 px-4 py-2 text-sm font-medium text-blue-900 hover:bg-blue-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2",onClick:async e=>y(e),children:"Upload"})})]}),(0,i.jsx)("div",{className:"mt-4",children:(0,i.jsx)("button",{type:"button",className:"inline-flex justify-center rounded-md border border-transparent bg-blue-100 px-4 py-2 text-sm font-medium text-blue-900 hover:bg-blue-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2",onClick:g,children:"Close"})})]})})})})]})})]})})}var v=n(1664),b=n.n(v),w=n(6667),j=n(3111);function N(e){let[t,n]=(0,s.useState)({loggedInAccount:void 0,loggedInPublicKey:void 0}),[a,c]=(0,s.useState)("");return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"flex-col",hidden:!!t.loggedInAccount,children:[(0,i.jsx)("div",{children:(0,i.jsx)("input",{type:"text",onChange:e=>c(e.target.value)})}),(0,i.jsxs)("div",{className:"flex flex-row text-xs items-center",children:[(0,i.jsx)("a",{href:"",onClick:async t=>{t.preventDefault();let{accountNameRes:i,pubKeyRes:c}=await S(a);n({loggedInAccount:i,loggedInPublicKey:c}),e.setUser(i),await (0,o.tx)('(accounts.create-account "'.concat(i,'" (read-keyset "sessionKeyset") "tmp.jpg")'),!1)},children:"Register"}),(0,i.jsx)("span",{children:"/"}),(0,i.jsx)("a",{href:"",onClick:async t=>{t.preventDefault();let{accountNameRes:i,pubKeyRes:c}=await C(a);n({loggedInAccount:i,loggedInPublicKey:c}),e.setUser(i)},children:"Sign In"})]})]}),(0,i.jsxs)("div",{className:"flex-col",hidden:!t.loggedInAccount,children:[(0,i.jsx)("p",{children:t.loggedInAccount}),(0,i.jsx)("p",{className:"text-ellipsis",children:t.loggedInPublicKey}),(0,i.jsx)("a",{href:"",onClick:async e=>{await k(e),n({loggedInAccount:void 0,loggedInPublicKey:void 0})},children:"Logout"})]})]})}async function k(e){let t=await fetch(w.b+"/api/v1/auth/logout",{credentials:"include"});if(!t.ok)throw Error(await t.text())}async function S(e){let t=await fetch(w.b+"/api/v1/auth/register/begin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accountName:e,accountDisplayName:e}),credentials:"include"}).catch(e=>e);if(!t.ok)throw Error(await t.text());let n=await t.json(),i=await (0,j.Ue)({publicKey:n}),a=await fetch(w.b+"/api/v1/auth/register/complete",{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!a.ok)throw Error(await t.text());let c=await a.json();console.log(JSON.stringify(c)),document.cookie="credentialId="+i.id,console.log("Set cookie");let s=await P();return{accountNameRes:s.accountName,pubKeyRes:s.pubKey}}async function C(e){console.log("login");let t=await fetch(w.b+"/api/v1/auth/login/begin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"});if(!t.ok)throw Error(await t.text());let n=await t.json();console.log("login response:"),console.log(n);let i=await (0,j.U2)({publicKey:n}),a=await fetch(w.b+"/api/v1/auth/login/complete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i),credentials:"include"});if(!a.ok)throw Error(await a.text());let c=await a.json();console.log(JSON.stringify(c)),document.cookie="credentialId="+i.id,console.log("Login Set cookie");let s=await P();return{accountNameRes:s.accountName,pubKeyRes:s.pubKey}}async function P(){console.log("setup_account_cookies");let e=await fetch(w.b+"/api/v1/auth/account-info",{credentials:"include"});if(!e.ok)throw Error(await e.text());let t=await e.json(),n=t.publicKeyHex;return console.log("setting public-key cookie to "+n),document.cookie="public-key="+n,console.log("setting account-name cookie to "+t.accountName),document.cookie="account-name="+t.accountName,console.log("finished setup_account_cookies"),{accountName:t.accountName,pubKey:n}}function O(e){return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("header",{className:"flex items-center justify-between px-4 py-2 bg-white dark:bg-slate-800 shadow-sm",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)(l.G,{icon:d.QY_}),"PactPics"]}),e.user?(0,i.jsxs)("div",{className:"flex flex-row",children:[(0,i.jsx)("div",{className:"p-1",children:(0,i.jsx)(b(),{href:"/admin",children:(0,i.jsx)(l.G,{icon:u.w49})})}),(0,i.jsx)("p",{className:"p-1",children:e.user}),(0,i.jsx)("p",{className:"p-1",onClick:async t=>await I(e.setUser),children:"Logout"})]}):(0,i.jsx)(N,{setUser:e.setUser})]})})}async function I(e){console.log(await fetch(w.b+"/logout")),E("credentialId"),E("account-name"),E("public-key"),e(void 0)}function E(e){document.cookie=e+"=; Max-Age=-99999999;"}function A(e){let[t,n]=(0,s.useState)([]);return(0,s.useEffect)(()=>{(async function(){let e=await (0,o.tx)("(accounts.list-accounts)",!1);n(e.result.data),console.log(e.result.data),e.result.data})()},[]),(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{className:"flex flex-row",children:(function(e,t){let n=t.filter(t=>t!=e);return[e,...n]})(e.user,t).map(t=>(0,i.jsx)("span",{className:t==e.picturesOwner?"p-1":"p-1 text-slate-500",onClick:n=>{var i;return i=e.setPicturesOwner,void(console.log("handleOwnerClick: "+t),i(t))},children:t==e.user?"Me":t},t))})})}function T(){let[e,t]=(0,s.useState)(void 0),[n,a]=(0,s.useState)([]),[r,l]=(0,s.useState)(void 0);return(0,s.useEffect)(()=>{let e=(0,o.ej)("account-name");t(e),l(e)},[]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(c(),{children:[(0,i.jsx)("title",{children:"PactPics"}),(0,i.jsx)("meta",{name:"description",content:"Generated by create next app"}),(0,i.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,i.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,i.jsxs)("div",{className:"h-screen dark:bg-slate-600",children:[(0,i.jsx)(O,{user:e,setUser:t}),(0,i.jsx)("main",{className:"flex flex-column justify-between align-center p-6 w-full",children:e&&(0,i.jsxs)("div",{className:"w-full",children:[(0,i.jsx)(A,{user:e,picturesOwner:r,setPicturesOwner:l}),(0,i.jsx)(y,{accountName:e,pictures:n,setPictures:a}),(0,i.jsx)(g,{accountName:r,pictures:n,setPictures:a,user:e})]})})]})]})}r.vc.autoAddCss=!1},6667:function(e,t,n){"use strict";n.d(t,{b:function(){return i}});let i="https://beanstalk.greg-testing-2023-02-07.com"},7614:function(e,t,n){"use strict";n.d(t,{ej:function(){return l},tx:function(){return r}});var i=n(7462),a=n.n(i),c=n(8247),s=n(6667),o=n(3111);async function r(e,t){let n=l("credentialId"),i={pubKey:l("public-key")};var r=new Uint8Array(32);self.crypto.getRandomValues(r);let u=JSON.stringify({networkId:null,payload:{exec:{data:{name:"Stuart",language:"Pact",sessionKeyset:[l("public-key")]},code:e}},signers:t?[i]:[],meta:{creationTime:0,ttl:0,gasLimit:0,chainId:"",gasPrice:0,sender:""},nonce:(0,c.c)(r)}),d=function(e){var t=new TextEncoder,n=new Uint8Array(32);let i=a()(n.length).update(t.encode(e)).digest(),s=(0,c.c)(i).replaceAll("/","_").replaceAll("+","-");return s}(u);var f={};if(t){let e=await (0,o.U2)({publicKey:{challenge:d,allowCredentials:[{id:n,type:"public-key"}],userVerification:"preferred"}}),t=e.response;f={authenticatorData:(0,c.c)((0,o.kI)(t.authenticatorData)),clientDataJSON:t.clientDataJSON,signature:(0,c.c)((0,o.kI)(t.signature))}}let p=t?[{sig:JSON.stringify(f)}]:[],g=await fetch(s.b+"/api/v1/execute",{method:"POST",headers:{"Content-Type":"application/json"},cache:"no-cache",body:JSON.stringify({hash:d,sigs:p,cmd:u}),credentials:"include"}),h=await g.json();return h}function l(e){var t;let n="; ".concat(document.cookie),i=n.split("; ".concat(e,"="));if(2===i.length)return null===(t=i.pop())||void 0===t?void 0:t.split(";").shift()}},3111:function(e,t,n){"use strict";function i(e){let t="==".slice(0,(4-e.length%4)%4),n=e.replace(/-/g,"+").replace(/_/g,"/")+t,i=atob(n),a=new ArrayBuffer(i.length),c=new Uint8Array(a);for(let e=0;e<i.length;e++)c[e]=i.charCodeAt(e);return a}function a(e){let t=new Uint8Array(e),n="";for(let e of t)n+=String.fromCharCode(e);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}n.d(t,{U2:function(){return v},Ue:function(){return y},kI:function(){return i}});var c="copy",s="convert";function o(e,t,n){if(t===c)return n;if(t===s)return e(n);if(t instanceof Array)return n.map(n=>o(e,t[0],n));if(t instanceof Object){let i={};for(let[a,c]of Object.entries(t)){if(c.derive){let e=c.derive(n);void 0!==e&&(n[a]=e)}if(a in n)null!=n[a]?i[a]=o(e,c.schema,n[a]):i[a]=null;else if(c.required)throw Error("Missing key: ".concat(a))}return i}}function r(e,t){return{required:!0,schema:e,derive:t}}function l(e){return{required:!0,schema:e}}function u(e){return{required:!1,schema:e}}var d={type:l(c),id:l(s),transports:u(c)},f={appid:u(c),appidExclude:u(c),credProps:u(c)},p={appid:u(c),appidExclude:u(c),credProps:u(c)},g={publicKey:l({rp:l(c),user:l({id:l(s),name:l(c),displayName:l(c)}),challenge:l(s),pubKeyCredParams:l(c),timeout:u(c),excludeCredentials:u([d]),authenticatorSelection:u(c),attestation:u(c),extensions:u(f)}),signal:u(c)},h={type:l(c),id:l(c),rawId:l(s),authenticatorAttachment:u(c),response:l({clientDataJSON:l(s),attestationObject:l(s),transports:r(c,e=>{var t;return(null==(t=e.getTransports)?void 0:t.call(e))||[]})}),clientExtensionResults:r(p,e=>e.getClientExtensionResults())},m={mediation:u(c),publicKey:l({challenge:l(s),timeout:u(c),rpId:u(c),allowCredentials:u([d]),userVerification:u(c),extensions:u(f)}),signal:u(c)},x={type:l(c),id:l(c),rawId:l(s),authenticatorAttachment:u(c),response:l({clientDataJSON:l(s),authenticatorData:l(s),signature:l(s),userHandle:l(s)}),clientExtensionResults:r(p,e=>e.getClientExtensionResults())};async function y(e){var t;return t=await navigator.credentials.create(o(i,g,e)),o(a,h,t)}async function v(e){var t;return t=await navigator.credentials.get(o(i,m,e)),o(a,x,t)}}},function(e){e.O(0,[976,123,930,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);